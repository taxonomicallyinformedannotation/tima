<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Annotate masses — annotate_masses • tima</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Annotate masses — annotate_masses"><meta name="description" content="This function annotates a feature table based on exact mass
match. It requires a structural library, its metadata, and lists of adducts,
clusters, and neutral losses to be considered. The polarity has to be pos
or neg and retention time and mass tolerances should be given. The feature
table is expected to be pre-formatted."><meta property="og:description" content="This function annotates a feature table based on exact mass
match. It requires a structural library, its metadata, and lists of adducts,
clusters, and neutral losses to be considered. The polarity has to be pos
or neg and retention time and mass tolerances should be given. The feature
table is expected to be pre-formatted."><meta property="og:image" content="https://taxonomicallyinformedannotation.github.io/tima/reference/figures/logo.svg"><meta property="og:image:alt" content="Taxonomically Informed Metabolite Annotation"><meta name="google-site-verification" content="Bt77rpBuC_R-0p62TWtA_ba5rvx-PuSEMv4LHg1UsOo"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tima</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.12.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/tima.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/I-gathering.html">1 Gathering everything you need</a></li>
    <li><a class="dropdown-item" href="../articles/II-preparing.html">2 Preparing inputs</a></li>
    <li><a class="dropdown-item" href="../articles/III-processing.html">3 Performing Taxonomically Informed Metabolite Annotation</a></li>
    <li><a class="dropdown-item" href="../articles/IV-benchmarking.html">4 Benchmarking Performance</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/taxonomicallyinformedannotation/tima/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Annotate masses</h1>
      <small class="dont-index">Source: <a href="https://github.com/taxonomicallyinformedannotation/tima/blob/main/R/annotate_masses.R" class="external-link"><code>R/annotate_masses.R</code></a></small>
      <div class="d-none name"><code>annotate_masses.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function annotates a feature table based on exact mass
match. It requires a structural library, its metadata, and lists of adducts,
clusters, and neutral losses to be considered. The polarity has to be <code>pos</code>
or <code>neg</code> and retention time and mass tolerances should be given. The feature
table is expected to be pre-formatted.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">annotate_masses</span><span class="op">(</span></span>
<span>  features <span class="op">=</span> <span class="fu"><a href="get_params.html">get_params</a></span><span class="op">(</span>step <span class="op">=</span> <span class="st">"annotate_masses"</span><span class="op">)</span><span class="op">$</span><span class="va">files</span><span class="op">$</span><span class="va">features</span><span class="op">$</span><span class="va">prepared</span>,</span>
<span>  output_annotations <span class="op">=</span> <span class="fu"><a href="get_params.html">get_params</a></span><span class="op">(</span>step <span class="op">=</span></span>
<span>    <span class="st">"annotate_masses"</span><span class="op">)</span><span class="op">$</span><span class="va">files</span><span class="op">$</span><span class="va">annotations</span><span class="op">$</span><span class="va">prepared</span><span class="op">$</span><span class="va">structural</span><span class="op">$</span><span class="va">ms1</span>,</span>
<span>  output_edges <span class="op">=</span> <span class="fu"><a href="get_params.html">get_params</a></span><span class="op">(</span>step <span class="op">=</span> <span class="st">"annotate_masses"</span><span class="op">)</span><span class="op">$</span><span class="va">files</span><span class="op">$</span><span class="va">networks</span><span class="op">$</span><span class="va">spectral</span><span class="op">$</span><span class="va">edges</span><span class="op">$</span><span class="va">raw</span>,</span>
<span>  name_source <span class="op">=</span> <span class="fu"><a href="get_params.html">get_params</a></span><span class="op">(</span>step <span class="op">=</span> <span class="st">"annotate_masses"</span><span class="op">)</span><span class="op">$</span><span class="va">names</span><span class="op">$</span><span class="va">source</span>,</span>
<span>  name_target <span class="op">=</span> <span class="fu"><a href="get_params.html">get_params</a></span><span class="op">(</span>step <span class="op">=</span> <span class="st">"annotate_masses"</span><span class="op">)</span><span class="op">$</span><span class="va">names</span><span class="op">$</span><span class="va">target</span>,</span>
<span>  library <span class="op">=</span> <span class="fu"><a href="get_params.html">get_params</a></span><span class="op">(</span>step <span class="op">=</span> <span class="st">"annotate_masses"</span><span class="op">)</span><span class="op">$</span><span class="va">files</span><span class="op">$</span><span class="va">libraries</span><span class="op">$</span><span class="va">sop</span><span class="op">$</span><span class="va">merged</span><span class="op">$</span><span class="va">keys</span>,</span>
<span>  str_stereo <span class="op">=</span> <span class="fu"><a href="get_params.html">get_params</a></span><span class="op">(</span>step <span class="op">=</span></span>
<span>    <span class="st">"annotate_masses"</span><span class="op">)</span><span class="op">$</span><span class="va">files</span><span class="op">$</span><span class="va">libraries</span><span class="op">$</span><span class="va">sop</span><span class="op">$</span><span class="va">merged</span><span class="op">$</span><span class="va">structures</span><span class="op">$</span><span class="va">stereo</span>,</span>
<span>  str_met <span class="op">=</span> <span class="fu"><a href="get_params.html">get_params</a></span><span class="op">(</span>step <span class="op">=</span></span>
<span>    <span class="st">"annotate_masses"</span><span class="op">)</span><span class="op">$</span><span class="va">files</span><span class="op">$</span><span class="va">libraries</span><span class="op">$</span><span class="va">sop</span><span class="op">$</span><span class="va">merged</span><span class="op">$</span><span class="va">structures</span><span class="op">$</span><span class="va">metadata</span>,</span>
<span>  str_nam <span class="op">=</span> <span class="fu"><a href="get_params.html">get_params</a></span><span class="op">(</span>step <span class="op">=</span></span>
<span>    <span class="st">"annotate_masses"</span><span class="op">)</span><span class="op">$</span><span class="va">files</span><span class="op">$</span><span class="va">libraries</span><span class="op">$</span><span class="va">sop</span><span class="op">$</span><span class="va">merged</span><span class="op">$</span><span class="va">structures</span><span class="op">$</span><span class="va">names</span>,</span>
<span>  str_tax_cla <span class="op">=</span> <span class="fu"><a href="get_params.html">get_params</a></span><span class="op">(</span>step <span class="op">=</span></span>
<span>    <span class="st">"annotate_masses"</span><span class="op">)</span><span class="op">$</span><span class="va">files</span><span class="op">$</span><span class="va">libraries</span><span class="op">$</span><span class="va">sop</span><span class="op">$</span><span class="va">merged</span><span class="op">$</span><span class="va">structures</span><span class="op">$</span><span class="va">taxonomies</span><span class="op">$</span><span class="va">cla</span>,</span>
<span>  str_tax_npc <span class="op">=</span> <span class="fu"><a href="get_params.html">get_params</a></span><span class="op">(</span>step <span class="op">=</span></span>
<span>    <span class="st">"annotate_masses"</span><span class="op">)</span><span class="op">$</span><span class="va">files</span><span class="op">$</span><span class="va">libraries</span><span class="op">$</span><span class="va">sop</span><span class="op">$</span><span class="va">merged</span><span class="op">$</span><span class="va">structures</span><span class="op">$</span><span class="va">taxonomies</span><span class="op">$</span><span class="va">npc</span>,</span>
<span>  adducts_list <span class="op">=</span> <span class="fu"><a href="get_params.html">get_params</a></span><span class="op">(</span>step <span class="op">=</span> <span class="st">"annotate_masses"</span><span class="op">)</span><span class="op">$</span><span class="va">ms</span><span class="op">$</span><span class="va">adducts</span>,</span>
<span>  clusters_list <span class="op">=</span> <span class="fu"><a href="get_params.html">get_params</a></span><span class="op">(</span>step <span class="op">=</span> <span class="st">"annotate_masses"</span><span class="op">)</span><span class="op">$</span><span class="va">ms</span><span class="op">$</span><span class="va">clusters</span>,</span>
<span>  neutral_losses_list <span class="op">=</span> <span class="fu"><a href="get_params.html">get_params</a></span><span class="op">(</span>step <span class="op">=</span> <span class="st">"annotate_masses"</span><span class="op">)</span><span class="op">$</span><span class="va">ms</span><span class="op">$</span><span class="va">neutral_losses</span>,</span>
<span>  ms_mode <span class="op">=</span> <span class="fu"><a href="get_params.html">get_params</a></span><span class="op">(</span>step <span class="op">=</span> <span class="st">"annotate_masses"</span><span class="op">)</span><span class="op">$</span><span class="va">ms</span><span class="op">$</span><span class="va">polarity</span>,</span>
<span>  tolerance_ppm <span class="op">=</span> <span class="fu"><a href="get_params.html">get_params</a></span><span class="op">(</span>step <span class="op">=</span> <span class="st">"annotate_masses"</span><span class="op">)</span><span class="op">$</span><span class="va">ms</span><span class="op">$</span><span class="va">tolerances</span><span class="op">$</span><span class="va">mass</span><span class="op">$</span><span class="va">ppm</span><span class="op">$</span><span class="va">ms1</span>,</span>
<span>  tolerance_rt <span class="op">=</span> <span class="fu"><a href="get_params.html">get_params</a></span><span class="op">(</span>step <span class="op">=</span> <span class="st">"annotate_masses"</span><span class="op">)</span><span class="op">$</span><span class="va">ms</span><span class="op">$</span><span class="va">tolerances</span><span class="op">$</span><span class="va">rt</span><span class="op">$</span><span class="va">adducts</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-features">features<a class="anchor" aria-label="anchor" href="#arg-features"></a></dt>
<dd><p>Table containing your previous annotation to complement</p></dd>


<dt id="arg-output-annotations">output_annotations<a class="anchor" aria-label="anchor" href="#arg-output-annotations"></a></dt>
<dd><p>Output for mass based structural annotations</p></dd>


<dt id="arg-output-edges">output_edges<a class="anchor" aria-label="anchor" href="#arg-output-edges"></a></dt>
<dd><p>Output for mass based edges</p></dd>


<dt id="arg-name-source">name_source<a class="anchor" aria-label="anchor" href="#arg-name-source"></a></dt>
<dd><p>Name of the source features column</p></dd>


<dt id="arg-name-target">name_target<a class="anchor" aria-label="anchor" href="#arg-name-target"></a></dt>
<dd><p>Name of the target features column</p></dd>


<dt id="arg-library">library<a class="anchor" aria-label="anchor" href="#arg-library"></a></dt>
<dd><p>Library containing the keys</p></dd>


<dt id="arg-str-stereo">str_stereo<a class="anchor" aria-label="anchor" href="#arg-str-stereo"></a></dt>
<dd><p>File containing structures stereo</p></dd>


<dt id="arg-str-met">str_met<a class="anchor" aria-label="anchor" href="#arg-str-met"></a></dt>
<dd><p>File containing structures metadata</p></dd>


<dt id="arg-str-nam">str_nam<a class="anchor" aria-label="anchor" href="#arg-str-nam"></a></dt>
<dd><p>File containing structures names</p></dd>


<dt id="arg-str-tax-cla">str_tax_cla<a class="anchor" aria-label="anchor" href="#arg-str-tax-cla"></a></dt>
<dd><p>File containing Classyfire taxonomy</p></dd>


<dt id="arg-str-tax-npc">str_tax_npc<a class="anchor" aria-label="anchor" href="#arg-str-tax-npc"></a></dt>
<dd><p>File containing NPClassifier taxonomy</p></dd>


<dt id="arg-adducts-list">adducts_list<a class="anchor" aria-label="anchor" href="#arg-adducts-list"></a></dt>
<dd><p>List of adducts to be used</p></dd>


<dt id="arg-clusters-list">clusters_list<a class="anchor" aria-label="anchor" href="#arg-clusters-list"></a></dt>
<dd><p>List of clusters to be used</p></dd>


<dt id="arg-neutral-losses-list">neutral_losses_list<a class="anchor" aria-label="anchor" href="#arg-neutral-losses-list"></a></dt>
<dd><p>List of neutral losses to be used</p></dd>


<dt id="arg-ms-mode">ms_mode<a class="anchor" aria-label="anchor" href="#arg-ms-mode"></a></dt>
<dd><p>Ionization mode. Must be 'pos' or 'neg'</p></dd>


<dt id="arg-tolerance-ppm">tolerance_ppm<a class="anchor" aria-label="anchor" href="#arg-tolerance-ppm"></a></dt>
<dd><p>Tolerance to perform annotation. Should be &lt;= 20 ppm</p></dd>


<dt id="arg-tolerance-rt">tolerance_rt<a class="anchor" aria-label="anchor" href="#arg-tolerance-rt"></a></dt>
<dd><p>Tolerance to group adducts. Should be &lt;= 0.05 minutes</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The path to the files containing MS1 annotations and edges</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="copy_backbone.html">copy_backbone</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="go_to_cache.html">go_to_cache</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">github</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/"</span></span></span>
<span class="r-in"><span><span class="va">repo</span> <span class="op">&lt;-</span> <span class="st">"taxonomicallyinformedannotation/tima-example-files/main/"</span></span></span>
<span class="r-in"><span><span class="va">data_interim</span> <span class="op">&lt;-</span> <span class="st">"data/interim/"</span></span></span>
<span class="r-in"><span><span class="va">dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">github</span>, <span class="va">repo</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dir</span>, <span class="va">data_interim</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">annotate_masses</span><span class="op">(</span></span></span>
<span class="r-in"><span>  features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dir</span>, <span class="st">"features/example_features.tsv"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  library <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dir</span>, <span class="st">"libraries/sop/merged/keys.tsv"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  str_stereo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dir</span>, <span class="st">"libraries/sop/merged/structures/stereo.tsv"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  str_met <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dir</span>, <span class="st">"libraries/sop/merged/structures/metadata.tsv"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  str_nam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dir</span>, <span class="st">"libraries/sop/merged/structures/names.tsv"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  str_tax_cla <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dir</span>, <span class="st">"libraries/sop/merged/structures/taxonomies/classyfire.tsv"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  str_tax_npc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dir</span>, <span class="st">"libraries/sop/merged/structures/taxonomies/npc.tsv"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="st">"data"</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Adriano Rutz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

