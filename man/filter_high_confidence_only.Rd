% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/filter_high_confidence_only.R
\name{filter_high_confidence_only}
\alias{filter_high_confidence_only}
\title{Filter high confidence only
\ifelse{html}{\href{https://lifecycle.r-lib.org/articles/stages.html#experimental}{\figure{lifecycle-experimental.svg}{options: alt='[Experimental]'}}}{\strong{[Experimental]}}}
\usage{
filter_high_confidence_only(
  df,
  score_bio_min = DEFAULT_HC_SCORE_BIO_MIN,
  score_ini_min = DEFAULT_HC_SCORE_INITIAL_MIN,
  score_final_min = DEFAULT_HC_SCORE_FINAL_MIN,
  error_rt_max = DEFAULT_HC_MAX_RT_ERROR_MIN,
  confidence_sirius_min = DEFAULT_HC_SCORE_SIRIUS_MIN,
  similarity_spectral_min = DEFAULT_HC_SCORE_SPECTRAL_MIN,
  matched_peaks_min = DEFAULT_HC_SCORE_MIN_PEAKS,
  context = NULL
)
}
\arguments{
\item{df}{Data frame containing annotation results with score columns}

\item{score_bio_min}{Numeric minimum biological score threshold (default: 0.85). Range: 0-1}

\item{score_ini_min}{Numeric minimum initial score threshold (default: 0.95). Range: 0-1}

\item{score_final_min}{Numeric minimum final (chemical) score threshold (default: 0.75). Range: 0-1}

\item{error_rt_max}{Numeric maximum retention time error in minutes (default: 0.05). Must be > 0}

\item{confidence_sirius_min}{Numeric minimum SIRIUS confidence score threshold (optional).
Range: 0-1. If provided, candidates WITH a confidence score below this threshold
are filtered out, but candidates with NA/missing scores are retained.}

\item{similarity_spectral_min}{Numeric minimum spectral similarity threshold (optional).
Range: 0-1. If provided, candidates WITH a similarity score below this threshold
are filtered out, but candidates with NA/missing scores are retained.}

\item{matched_peaks_min}{Numeric minimum count of matched peaks threshold (optional).
Must be >= 0 (typically a small integer). If provided, candidates WITH a matched
peak count below this threshold are filtered out, but candidates with NA/missing
peak counts are retained.}

\item{context}{Optional character string to tag logs with a stage label (e.g.,
"mini+filtered" or "full"). Defaults to NULL (no tag).}
}
\value{
Data frame containing only high-confidence annotations that meet
at least one score threshold and pass RT error filtering
}
\description{
This function filters annotation results to retain only
high-confidence candidates based on multiple scoring criteria
(biological, initial, chemical) and retention time accuracy.
}
\details{
Columns used when present:
\itemize{
\item score_biological
\item candidate_score_pseudo_initial
\item score_weighted_chemo
\item candidate_structure_error_rt (assumed in minutes; NA means unknown and is allowed)
\item candidate_score_sirius_confidence (optional, NA values allowed)
\item candidate_similarity (optional, NA values allowed, 0 always filtered)
\item candidate_matched_peaks (optional, NA values allowed)
}

Missing score columns are treated as absent for that criterion and do not
cause errors; at least one of the three primary scores must satisfy its
threshold for a row to be retained.

\strong{NA value handling:}
\itemize{
\item RT error: NA values (unknown RT) are allowed to pass
\item SIRIUS confidence: NA values (no SIRIUS annotation) are allowed to pass
\item Spectral similarity: NA values (no spectral match) are allowed to pass, but 0 is ALWAYS filtered
\item Matched peaks: NA values (no peak matching data) are allowed to pass
}

\strong{SIRIUS and Spectral filtering (OR logic):}
When both \code{confidence_sirius_min} and \code{similarity_spectral_min} are set,
candidates pass if EITHER the SIRIUS confidence OR spectral similarity meets
its threshold. This allows candidates with good SIRIUS but poor spectral match
(or vice versa) to pass. Spectral similarity = 0 is always filtered out as invalid.

This means thresholds only apply when the corresponding value is present.
}
\examples{
\dontrun{
# Filter to high-confidence annotations only
high_conf <- filter_high_confidence_only(
  df = annotations,
  score_bio_min = 0.85,
  score_ini_min = 0.95,
  score_final_min = 0.75,
  error_rt_max = 0.05,
  context = "final_filtered"
)

# With SIRIUS confidence threshold
high_conf <- filter_high_confidence_only(
  df = annotations,
  confidence_sirius_min = 0.8,
  similarity_spectral_min = 0.7
)
}
}
\keyword{internal}
